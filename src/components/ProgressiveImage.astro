---
const { webpSrc, pngSrc, alt, class: className = "" } = Astro.props;
---

<div class={`progressive-image-container ${className}`}>
  <img 
    src={webpSrc} 
    alt={alt} 
    loading="lazy" 
    class="progressive-image-webp"
  />
  <img 
    src={pngSrc} 
    alt={alt} 
    loading="lazy" 
    class="progressive-image-png"
    style="opacity: 0; position: absolute; top: 0; left: 0;"
  />
</div>

<style>
  .progressive-image-container {
    position: relative;
    display: inline-block;
  }

  .progressive-image-webp {
    transition: opacity 0.3s ease-in-out;
  }

  .progressive-image-png {
    transition: opacity 0.3s ease-in-out;
  }

  .progressive-image-png.loaded {
    opacity: 1 !important;
  }

  .progressive-image-webp.fade-out {
    opacity: 0;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const containers = document.querySelectorAll('.progressive-image-container');
    
    containers.forEach(container => {
      const webpImg = container.querySelector('.progressive-image-webp');
      const pngImg = container.querySelector('.progressive-image-png');
      
      if (!webpImg || !pngImg) return;
      
      // When PNG loads, fade it in and fade out the webp
      pngImg.addEventListener('load', function() {
        pngImg.classList.add('loaded');
        webpImg.classList.add('fade-out');
      });
      
      // If PNG fails to load, keep the webp visible
      pngImg.addEventListener('error', function() {
        console.warn('Failed to load PNG image:', pngImg.getAttribute('src'));
      });
    });
  });
</script> 